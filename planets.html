<!doctype html>
<html>

<head>
<title>Planets</title>
<meta charset="utf-8">
<link href="css/planets.css" rel="stylesheet">

<!-- Useful 3rd party libraries -->
<script type="text/javascript" src="js/jquery-1.12.2.min.js"></script>
<script type="text/javascript" src="js/glMatrix-0.9.5.js"></script>

<!-- Shader initialization utils -->
<script type="text/javascript" src="js/shader-utils.js"></script>

<!-- WebGL debugging utils -->
<script type="text/javascript" src="js/webgl-debug.js"></script>
<script type="text/javascript" src="js/debug-utils.js"></script>

<script type="text/javascript" src="planet_gen.js"></script>

<!-- WebGL functions -->
<script type="text/javascript" src="planets_webgl.js"></script>

<!-- Other javascript functions -->
<script type="text/javascript" src="planets.js"></script>

<!-- Vertex shader -->
<script id="shader-vs" type="x-shader/x-vertex">
    uniform mat4 uMVMatrix;             // Model-view matrix
    uniform mat4 uPMatrix;              // Projection matrix
    uniform mat4 uNMatrix;              // Normal matrix

    attribute vec3 aVertexPosition;     // Vertex position in object space
    attribute vec3 aVertexNormal;       // Vertex normal in object space
    attribute vec3 aVertexColor;

    varying vec3 vPosition;             // Vertex position (camera space)
    varying vec3 vNormal;               // Vertex normal (camera space)
    varying vec3 vColor;

    void main(void) {
        vec4 camSpacePosition = uMVMatrix * vec4(aVertexPosition, 1.0);
        vPosition = vec3(camSpacePosition);

        gl_Position = uPMatrix * camSpacePosition;        

        vec4 camSpaceNormal = uNMatrix * vec4(aVertexNormal, 0.0);
        vNormal = vec3(camSpaceNormal);
        vColor = aVertexColor;
    }
</script>

<!-- Fragment shader (Blinn-Phong) -->
<script id="shader-fs" type="x-shader/x-fragment">
    precision mediump float;

    uniform vec3 uLightPos;             // Light position in camera space
    varying vec3 vPosition;             // Fragment position (camera space)
    varying vec3 vNormal;               // Fragment normal (camera space)
    varying vec3 vColor;

    void main(void) {
        vec3 vLight = uLightPos - vPosition;
        float dist = length(vLight);
        vLight = vLight/dist;

        vec3 vView = normalize(-vPosition);
        vec3 vHalf = normalize(vView + vLight);
        vec3 vNormal_ = normalize(vNormal);
        if ( dot(vNormal_, vView) < 0.0 ) vNormal_ = -vNormal_;
        float ambient = 0.2;
        float diff = max(dot(vNormal_, vLight), 0.0);
        float spec = pow(max(dot(vNormal_, vHalf), 0.0), 10.0);
        vec3 I = 5.0*(vColor*diff + spec)/(5.0 + 0.2*dist*dist) + vColor*ambient;

        gl_FragColor = vec4(I, 1.0);
    }
</script>
</head>


<!-- HTML contents -->
<body bgcolor = "#CCCCCC">
    <h1>CS114 Final Project: Procedural Planet Renderer</h1>

    <div style="margin-top:10px">
        <canvas id="canvas0" style="border:none;" width="1024" height="768"></canvas>
    </div>
    <div style="margin-left:10px">
        <div class="panel">
            <p>Rendering Control</p>
            <table>
                <tr>
                    <td width="200px">Resolution</td>
                    <td width="230px">
                        <select onchange="changeResolution(this.value);">
                            <option value="0">480x320</option>
                            <option value="1">800x600</option>
                            <option value="2" selected="selected">1024x768</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Drawing Mode</td>
                    <td>
                        <select onchange="changeMode(this.value);">
                            <option value="0" selected="selected">Normal</option>
                            <option value="1">Wire-frame</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>Planet Type</td>
                    <td>
                        <select onchange="changePlanetType(this.value);">
                            <option value="0" selected="selected">Earth</option>
                            <option value="1">Lava</option>
                            <option value="2">Frozen</option>
                        </select>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div style="margin-left:10px">
        <div class="panel">
            <p>Animation Control</p>
            <table>
                <tr>
                    <td><input type="checkbox" onchange="setPlanetRotating(this.checked);">Rotate Planet</td>
                    <td>
                        <input id="sliderBarPlanet" type="range" min="1" max="36" value="6" onchange="updateSliderPlanet(this.value);">
                        (<span id="sliderAmountPlanet">60</span>&deg;/s)
                    </td>
                </tr>        
                <tr>
                    <td><input type="checkbox" onchange="setLightRotating(this.checked);">Rotate Light</td>
                    <td>
                        <input id="sliderBarLight" type="range" min="1" max="36" value="6" onchange="updateSliderLight(this.value);">
                        (<span id="sliderAmountLight">60</span>&deg;/s)
                    </td>
                </tr>   
            </table>
        </div>
    </div>
</body>

</html>
